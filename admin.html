<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - EasyCal Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-white">
  <div class="p-10">
    <h1 class="text-4xl font-bold mb-8">ðŸ‘‘ Admin Dashboard</h1>
    <button onclick="addNewUser()" class="mb-6 px-6 py-3 bg-emerald-600 rounded-2xl">+ Add New User</button>
    
    <table class="w-full bg-zinc-900 rounded-3xl overflow-hidden">
      <thead><tr class="bg-zinc-800"><th class="p-6 text-left">Username</th><th>Email</th><th>Role</th><th>Expiry</th><th>Actions</th></tr></thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center">
    <!-- form fields for edit -->
  </div>
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  EasyCal-Pro â€“ Shared JavaScript (all pages)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const DB_KEY         = 'easycal_users';
const CURRENT_USER   = 'easycal_current_user';
const THEME_KEY      = 'easycal_theme';

let users        = [];
let currentUser  = null;

// â”€â”€â”€ Theme / Dark mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleDarkMode() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');

    const btn = document.getElementById('themeToggle');
    if (btn) btn.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
}

function initTheme() {
    const saved = localStorage.getItem(THEME_KEY);
    const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (saved === 'dark' || (!saved && preferDark)) {
        document.documentElement.classList.add('dark');
        const btn = document.getElementById('themeToggle');
        if (btn) btn.textContent = 'â˜€ï¸';
    }
}

// â”€â”€â”€ Database helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadUsers() {
    const saved = localStorage.getItem(DB_KEY);
    if (saved) {
        users = JSON.parse(saved);
        return;
    }

    // First time â†’ fetch initial JSON
    fetch('user-database.json')
        .then(r => {
            if (!r.ok) throw new Error('user-database.json not found');
            return r.json();
        })
        .then(data => {
            users = data;
            saveUsers();
        })
        .catch(err => {
            console.error(err);
            users = [
                {
                    id: 1, username: "admin", password: "12345",
                    email: "admin@easycal.pro", role: "admin",
                    name: "Admin User", expiry: "2099-12-31",
                    profile: { phone: "+8801955255066", bio: "App Devloper" }
                }
            ];
            saveUsers();
        });
}

function saveUsers() {
    localStorage.setItem(DB_KEY, JSON.stringify(users));
}

// â”€â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getCurrentUser() {
    const json = localStorage.getItem(CURRENT_USER);
    return json ? JSON.parse(json) : null;
}

function setCurrentUser(user) {
    currentUser = user;
    if (user) {
        localStorage.setItem(CURRENT_USER, JSON.stringify(user));
    } else {
        localStorage.removeItem(CURRENT_USER);
    }
}

function logout() {
    setCurrentUser(null);
    window.location.href = 'index.html';
}

// â”€â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showModal(id) {
    document.getElementById(id).classList.remove('hidden');
}

function hideModal(id) {
    document.getElementById(id).classList.add('hidden');
}

function closeModal(e) {
    if (e.target.classList.contains('fixed')) {
        e.target.classList.add('hidden');
    }
}

// â”€â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleLogin() {
    const input = document.getElementById('loginUser')?.value.trim();
    const pass  = document.getElementById('loginPass')?.value;

    if (!input || !pass) {
        alert('Please enter username/email and password');
        return;
    }

    const user = users.find(u =>
        (u.username.toLowerCase() === input.toLowerCase() ||
         u.email.toLowerCase() === input.toLowerCase()) &&
        u.password === pass
    );

    if (user) {
        setCurrentUser(user);
        window.location.href = 'dashboard.html';
    } else {
        alert('Incorrect username/email or password');
    }
}

// â”€â”€â”€ Register â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleRegister() {
    const name     = document.getElementById('regName')?.value.trim();
    const email    = document.getElementById('regEmail')?.value.trim();
    const username = document.getElementById('regUser')?.value.trim();
    const password = document.getElementById('regPass')?.value;

    if (!name || !email || !username || !password) {
        alert('Please fill in all fields');
        return;
    }

    if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
        alert('Username already taken');
        return;
    }

    if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
        alert('Email already registered');
        return;
    }

    const newUser = {
        id: Date.now(),
        username,
        email,
        password,           // In real app â†’ NEVER store plain text!
        role: 'user',
        name,
        expiry: new Date(Date.now() + 365*24*60*60*1000).toISOString().split('T')[0],
        profile: {
            phone: '',
            bio: 'New member'
        }
    };

    users.push(newUser);
    saveUsers();

    // Prepare email content
    const subject = encodeURIComponent('New EasyCal-Pro Registration');
    const body = encodeURIComponent(
        `New user registration request:\n\n` +
        `Name:     ${name}\n` +
        `Email:    ${email}\n` +
        `Username: ${username}\n` +
        `Password: ${password}\n\n` +
        `Please review and activate manually.`
    );

    window.location.href = `mailto:millonhossain1993@gmail.com?subject=\( {subject}&body= \){body}`;

    alert('Registration request sent to easycal.app@gmail.com!\nYou may login after approval.');
    hideModal('registerModal');
}

// â”€â”€â”€ Dashboard profile fill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fillDashboardProfile() {
    const cu = getCurrentUser();
    if (!cu) {
        window.location.href = 'index.html';
        return;
    }

    document.getElementById('welcomeName').textContent = `Welcome, ${cu.name.split(' ')[0]}`;
    document.getElementById('expiryDate').textContent   = cu.expiry;

    document.getElementById('profName').textContent  = cu.name;
    document.getElementById('profEmail').textContent = cu.email;
    document.getElementById('profPhone').textContent = cu.profile.phone || 'â€”';
    document.getElementById('profBio').textContent   = cu.profile.bio   || 'â€”';
}

// â”€â”€â”€ Phone number tool â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function processPhone() {
    const input  = document.getElementById('phoneInput')?.value.trim();
    const result = document.getElementById('phoneResult');

    if (!input || !result) return;

    let num = input.replace(/[^\d+]/g, '');
    if (num.startsWith('88')) num = '+' + num;
    if (!num.startsWith('+')) num = '+88' + num;

    const bdMatch = num.match(/^\+8801[3-9]\d{8}$/);
    if (!bdMatch) {
        result.innerHTML = `<p class="text-red-600 font-medium">Invalid Bangladeshi mobile number</p>`;
        return;
    }

    const prefix = num.substring(4,7); // 88017x â†’ 017
    const carriers = {
        '013': 'Grameenphone',
        '014': 'Banglalink',
        '015': 'Teletalk',
        '016': 'Airtel',
        '017': 'Grameenphone',
        '018': 'Robi',
        '019': 'Banglalink'
    };

    const carrier = carriers[prefix] || 'Unknown operator';

    result.innerHTML = `
        <p class="text-emerald-600 font-semibold text-lg">Valid BD Mobile Number âœ“</p>
        <p class="mt-2"><strong>International:</strong> ${num}</p>
        <p><strong>Local:</strong> 0${num.substring(4)}</p>
        <p><strong>Operator:</strong> ${carrier}</p>
    `;
}

// â”€â”€â”€ Password generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePassword() {
    const len    = parseInt(document.getElementById('passLength')?.value) || 16;
    const upper  = document.getElementById('upper')?.checked ?? true;
    const lower  = document.getElementById('lower')?.checked ?? true;
    const num    = document.getElementById('num')?.checked   ?? true;
    const sym    = document.getElementById('sym')?.checked   ?? false;

    const sets = {
        upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        lower: 'abcdefghijklmnopqrstuvwxyz',
        num:   '0123456789',
        sym:   '!@#$%^&*()_+-=[]{}|;:,.<>?'
    };

    let chars = '';
    if (upper) chars += sets.upper;
    if (lower) chars += sets.lower;
    if (num)   chars += sets.num;
    if (sym)   chars += sets.sym;

    if (!chars) {
        alert('Select at least one character type');
        return;
    }

    let pw = '';
    for (let i = 0; i < len; i++) {
        pw += chars[Math.floor(Math.random() * chars.length)];
    }

    document.getElementById('generatedPass').value = pw;
    updateStrength(pw);
}

function updateStrength(pw) {
    const el = document.getElementById('strength');
    if (!el) return;

    let score = 0;
    if (pw.length >= 8)  score++;
    if (pw.length >= 12) score++;
    if (/[A-Z]/.test(pw)) score++;
    if (/[0-9]/.test(pw)) score++;
    if (/[^A-Za-z0-9]/.test(pw)) score++;

    const levels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong', 'Excellent'];
    const colors = ['text-red-600', 'text-orange-500', 'text-yellow-500', 'text-lime-600', 'text-emerald-600', 'text-teal-600'];

    el.textContent = levels[score] || 'Very Weak';
    el.className = colors[score] || 'text-red-600';
}

function copyPassword() {
    const field = document.getElementById('generatedPass');
    if (!field?.value) return;

    field.select();
    navigator.clipboard.writeText(field.value).then(() => {
        const btn = document.getElementById('copyBtn');
        const orig = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = orig, 1800);
    });
}

// â”€â”€â”€ Admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadAdminTable() {
    const tbody = document.getElementById('userTable');
    if (!tbody) return;

    tbody.innerHTML = '';

    users.forEach(user => {
        const tr = document.createElement('tr');
        tr.className = 'border-b border-zinc-800 hover:bg-zinc-800/50';
        tr.innerHTML = `
            <td class="p-5">${user.username}</td>
            <td class="p-5">${user.email}</td>
            <td class="p-5">${user.role}</td>
            <td class="p-5">${user.expiry}</td>
            <td class="p-5">
                <button onclick="openEditUser(${user.id})" class="text-indigo-400 hover:text-indigo-300 mr-3">Edit</button>
                <button onclick="deleteUser(${user.id})" class="text-red-400 hover:text-red-300">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function openEditUser(id) {
    const user = users.find(u => u.id === id);
    if (!user) return;

    // You can create a modal dynamically or use an existing one
    alert(`Edit user:\n${JSON.stringify(user, null, 2)}\n\n(Implement full modal here)`);

    // Example: you could open a modal and fill fields
    // For brevity we just show alert in this version
}

function deleteUser(id) {
    if (!confirm('Delete this user permanently?')) return;

    users = users.filter(u => u.id !== id);
    saveUsers();
    loadAdminTable();
}

// â”€â”€â”€ Tool launcher (placeholder) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openTool(name) {
    // You can create real modals or separate pages later
    if (name === 'phone') {
        alert('Phone tool opened\n(Implement modal / section here)');
    } else if (name === 'password') {
        alert('Password generator opened');
    } else {
        alert(`${name} tool â€“ coming soon`);
    }
}

// â”€â”€â”€ Init on every page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
    initTheme();
    loadUsers();

    currentUser = getCurrentUser();

    // Protect dashboard & admin
    if (window.location.pathname.includes('dashboard') ||
        window.location.pathname.includes('admin')) {
        if (!currentUser) {
            window.location.href = 'index.html';
        }
    }

    // Dashboard specific
    if (document.getElementById('welcomeName')) {
        fillDashboardProfile();
    }

    // Admin specific
    if (document.getElementById('userTable')) {
        if (currentUser?.role !== 'admin') {
            alert('Access denied');
            window.location.href = 'dashboard.html';
        }
        loadAdminTable();
    }

    // Attach global close on backdrop click
    document.querySelectorAll('.fixed.inset-0').forEach(modal => {
        modal.addEventListener('click', closeModal);
    });
});
</script>
</body>
</html>